<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    <title>Ember.js - Routing: Asynchronous Routing</title>
    <meta property="st:title" content="Routing: Asynchronous Routing" />
    <link href="../../images/favicon.png" rel="icon" type="image/png" />
    <!--[if lte IE 7 ]><link href="../../stylesheets/fonts/fontello-ie7.css" rel="stylesheet" /><![endif]-->
    <link href="../../stylesheets/site.css" rel="stylesheet" />
    <link href="/blog/feed.xml" rel="alternate" type="application/atom+xml" title="Ember.js - Blog" />
    
  </head>

  <body class="guides routing routing_asynchronous-routing routing_asynchronous-routing_index">

    <!--[if lt IE 9]>
      <script src="../../javascripts/common-old-ie.js"></script>
    <![endif]-->
    <!--[if gte IE 9]><!-->
      <script src="../../javascripts/common-modern.js"></script>
    <!--<![endif]-->

    <div id="header">
      <div id="wrapper">
        <a id="logo" href="http://emberjs.com/">&nbsp;</a>
        <ul id="nav">
          <li>
            <a href="http://emberjs.com/">about</a>
          </li>
          <li class="active">
            <a href="/">guides</a>
          </li>
          <li>
            <a href="http://emberjs.com/api">api</a>
          </li>
          <li>
            <a href="http://emberjs.com/community">community</a>
          </li>
          <li>
            <a href="http://emberjs.com/blog">blog</a>
          </li>
          <li>
            <a href="http://emberjs.com/builds">builds</a>
          </li>

          <li id="search">
            <form>
              <input type="text" id="st-search-input" class="st-search-input" placeholder="Search the guides"/>
            </form>
            <div id="st-results-container"></div>
          </li>
        </ul>

        <div id="github">
          <a href="https://github.com/emberjs/ember.js"><i class="icon-fork"></i>Fork Us!</a>
        </div>
      </div>
    </div>

    

    <div id="content-wrapper">
      <div id="sidebar-wrapper">
        <select class="version-select" style="width: 100%"></select>
        <div id="sidebar">

          <ol class='toc-level-0 selected'><li class='toc-level-0 '><a href="#">Getting Started</a><ol class='toc-level-1'><li class='toc-level-1 '><a href="../../getting-started/">Installing Ember</a></li><li class='toc-level-1 '><a href="../../getting-started/first-app/">Your First Ember App</a></li><li class='toc-level-1 '><a href="../../getting-started/core-concepts/">Core Concepts</a></li></ol></li><li class='toc-level-0 '><a href="#">The Object Model</a><ol class='toc-level-1'><li class='toc-level-1 '><a href="../../object-model/">Objects in Ember</a></li><li class='toc-level-1 '><a href="../../object-model/classes-and-instances/">Classes and Instances</a></li><li class='toc-level-1 '><a href="../../object-model/reopening-classes-and-instances/">Reopening Classes and Instances</a></li><li class='toc-level-1 '><a href="../../object-model/computed-properties/">Computed Properties</a></li><li class='toc-level-1 '><a href="../../object-model/computed-properties-and-aggregate-data/">Computed Properties and Aggregate Data</a></li><li class='toc-level-1 '><a href="../../object-model/observers/">Observers</a></li><li class='toc-level-1 '><a href="../../object-model/bindings/">Bindings</a></li><li class='toc-level-1 '><a href="../../object-model/enumerables/">Enumerables</a></li></ol></li><li class='toc-level-0 selected'><a href="#">Routing</a><ol class='toc-level-1 selected'><li class='toc-level-1 '><a href="../">Introduction</a></li><li class='toc-level-1 '><a href="../defining-your-routes/">Defining Your Routes</a></li><li class='toc-level-1 '><a href="../specifying-a-routes-model/">Specifying a Route's Model</a></li><li class='toc-level-1 '><a href="../rendering-a-template/">Rendering a Template</a></li><li class='toc-level-1 '><a href="../redirection/">Redirecting</a></li><li class='toc-level-1 '><a href="../preventing-and-retrying-transitions/">Preventing and Retrying Transitions</a></li><li class='toc-level-1 '><a href="../loading-and-error-substates/">Loading / Error Substates</a></li><li class='toc-level-1 '><a href="../query-params/">Query Parameters</a></li><li class='toc-level-1 selected'><a href="./">Asynchronous Routing</a></li></ol></li><li class='toc-level-0 '><a href="#">Templates</a><ol class='toc-level-1'><li class='toc-level-1 '><a href="../../templates/handlebars-basics/">Handlebars Basics</a></li><li class='toc-level-1 '><a href="../../templates/conditionals/">Conditionals</a></li><li class='toc-level-1 '><a href="../../templates/displaying-a-list-of-items/">Displaying a List of Items</a></li><li class='toc-level-1 '><a href="../../templates/binding-element-attributes/">Binding Element Attributes</a></li><li class='toc-level-1 '><a href="../../templates/links/">Links</a></li><li class='toc-level-1 '><a href="../../templates/actions/">Actions</a></li><li class='toc-level-1 '><a href="../../templates/input-helpers/">Input Helpers</a></li><li class='toc-level-1 '><a href="../../templates/development-helpers/">Development Helpers</a></li><li class='toc-level-1 '><a href="../../templates/writing-helpers/">Writing Helpers</a></li></ol></li><li class='toc-level-0 '><a href="#">Components</a><ol class='toc-level-1'><li class='toc-level-1 '><a href="../../components/defining-a-component/">Defining a Component</a></li><li class='toc-level-1 '><a href="../../components/passing-properties-to-a-component/">Passing Properties to a Component</a></li><li class='toc-level-1 '><a href="../../components/wrapping-content-in-a-component/">Wrapping Content in a Component</a></li><li class='toc-level-1 '><a href="../../components/customizing-a-components-element/">Customizing a Component's Element</a></li><li class='toc-level-1 '><a href="../../components/handling-events/">Handling Events</a></li><li class='toc-level-1 '><a href="../../components/triggering-changes-with-actions/">Triggering Changes with Actions</a></li></ol></li><li class='toc-level-0 '><a href="#">Controllers</a><ol class='toc-level-1'><li class='toc-level-1 '><a href="../../controllers/">Introduction</a></li><li class='toc-level-1 '><a href="../../controllers/dependencies-between-controllers/">Managing Dependencies Between Controllers</a></li></ol></li><li class='toc-level-0 '><a href="#">Models</a><ol class='toc-level-1'><li class='toc-level-1 '><a href="../../models/">Introduction</a></li><li class='toc-level-1 '><a href="../../models/defining-models/">Defining Models</a></li><li class='toc-level-1 '><a href="../../models/finding-records/">Finding Records</a></li><li class='toc-level-1 '><a href="../../models/creating-updating-and-deleting-records/">Creating, Updating and Deleting</a></li><li class='toc-level-1 '><a href="../../models/pushing-records-into-the-store/">Pushing Records into the Store</a></li><li class='toc-level-1 '><a href="../../models/working-with-relationships/">Working with Relationships</a></li><li class='toc-level-1 '><a href="../../models/handling-metadata/">Handling Metadata</a></li><li class='toc-level-1 '><a href="../../models/customizing-adapters/">Customizing Adapters</a></li><li class='toc-level-1 '><a href="../../models/customizing-serializers/">Customizing Serializers</a></li></ol></li><li class='toc-level-0 '><a href="#">Application Concerns</a><ol class='toc-level-1'><li class='toc-level-1 '><a href="../../applications/applications-and-instances/">Applications and Instances</a></li><li class='toc-level-1 '><a href="../../applications/dependency-injection/">Dependency Injection</a></li><li class='toc-level-1 '><a href="../../applications/initializers/">Initializers</a></li><li class='toc-level-1 '><a href="../../applications/services/">Services</a></li><li class='toc-level-1 '><a href="../../applications/run-loop/">The Run Loop</a></li></ol></li><li class='toc-level-0 '><a href="#">Testing</a><ol class='toc-level-1'><li class='toc-level-1 '><a href="../../testing/">Introduction</a></li><li class='toc-level-1 '><a href="../../testing/acceptance/">Acceptance Tests</a></li><li class='toc-level-1 '><a href="../../testing/unit-testing-basics/">Unit Testing Basics</a></li><li class='toc-level-1 '><a href="../../testing/testing-components/">Testing Components</a></li><li class='toc-level-1 '><a href="../../testing/testing-controllers/">Testing Controllers</a></li><li class='toc-level-1 '><a href="../../testing/testing-routes/">Testing Routes</a></li><li class='toc-level-1 '><a href="../../testing/testing-models/">Testing Models</a></li></ol></li><li class='toc-level-0 '><a href="#">Ember Inspector</a><ol class='toc-level-1'><li class='toc-level-1 '><a href="../../ember-inspector/installation/">Installing the Inspector</a></li><li class='toc-level-1 '><a href="../../ember-inspector/object-inspector/">Object Inspector</a></li><li class='toc-level-1 '><a href="../../ember-inspector/view-tree/">The View Tree</a></li><li class='toc-level-1 '><a href="../../ember-inspector/routes/">Inspecting Routes</a></li><li class='toc-level-1 '><a href="../../ember-inspector/data/">Data Tab</a></li><li class='toc-level-1 '><a href="../../ember-inspector/deprecations/">Tackling Deprecations</a></li><li class='toc-level-1 '><a href="../../ember-inspector/info/">Library Info</a></li><li class='toc-level-1 '><a href="../../ember-inspector/promises/">Debugging Promises</a></li><li class='toc-level-1 '><a href="../../ember-inspector/container/">Inspecting Objects via the Container</a></li><li class='toc-level-1 '><a href="../../ember-inspector/render-performance/">Rendering Performance</a></li><li class='toc-level-1 '><a href="../../ember-inspector/troubleshooting/">Troubleshooting</a></li></ol></li><li class='toc-level-0 '><a href="#">Addons and Dependencies</a><ol class='toc-level-1'><li class='toc-level-1 '><a href="../../addons-and-dependencies/managing-dependencies/">Managing Dependencies</a></li></ol></li><li class='toc-level-0 '><a href="#">Configuring Ember.js</a><ol class='toc-level-1'><li class='toc-level-1 '><a href="../../configuring-ember/configuring-your-app/">Configuring Your App</a></li><li class='toc-level-1 '><a href="../../configuring-ember/configuring-ember-cli/">Configuring Ember CLI</a></li><li class='toc-level-1 '><a href="../../configuring-ember/disabling-prototype-extensions/">Disabling Prototype Extensions</a></li><li class='toc-level-1 '><a href="../../configuring-ember/specifying-url-type/">Specifying the URL Type</a></li><li class='toc-level-1 '><a href="../../configuring-ember/embedding-applications/">Embedding Applications</a></li><li class='toc-level-1 '><a href="../../configuring-ember/feature-flags/">Feature Flags</a></li><li class='toc-level-1 '><a href="../../configuring-ember/debugging/">Debugging</a></li></ol></li><li class='toc-level-0 '><a href="#">Contributing to Ember.js</a><ol class='toc-level-1'><li class='toc-level-1 '><a href="../../contributing/adding-new-features/">Adding New Features</a></li><li class='toc-level-1 '><a href="../../contributing/repositories/">Repositories</a></li></ol></li></ol>
          <div id="back-to-top"><a id="back-top-top" href="#">&#11014; Back to Top</a></div>
        </div>
      </div>
      <div id="content" class="has-sidebar">
        <div class="chapter">
          <h1>
            Asynchronous Routing
            <a href="https://github.com/emberjs/guides/edit/master/source/routing/asynchronous-routing.md"
               target="_blank" class="edit-page icon-pencil">Edit Page</a>
          </h1>
          <hr>

          <p>This section covers some more advanced features of the router and its
capability for handling complex async logic within your app.</p>
<h3 class='anchorable-toc' id='toc_a-word-on-promises'>A Word on Promises...</h3>
<p>Ember&#39;s approach to handling asynchronous logic in the router makes
heavy use of the concept of Promises. In short, promises are objects that
represent an eventual value. A promise can either <em>fulfill</em>
(successfully resolve the value) or <em>reject</em> (fail to resolve the
value). The way to retrieve this eventual value, or handle the cases
when the promise rejects, is via the promise&#39;s <code>then</code> method, which
accepts two optional callbacks, one for fulfillment and one for
rejection. If the promise fulfills, the fulfillment handler gets called
with the fulfilled value as its sole argument, and if the promise rejects,
the rejection handler gets called with a reason for the rejection as its
sole argument. For example:</p>
<div class="highlight js "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
</pre></td>
  <td class="code"><pre><span class="keyword">var</span> promise = fetchTheAnswer();

promise.then(fulfill, reject);

<span class="keyword">function</span> <span class="function">fulfill</span>(answer) {
  console.log(<span class="string"><span class="delimiter">'</span><span class="content">The answer is </span><span class="delimiter">'</span></span> + answer);
}

<span class="keyword">function</span> <span class="function">reject</span>(reason) {
  console.log(<span class="error">`</span>Couldn<span class="string"><span class="delimiter">'</span><span class="content">t get the answer! Reason: ${reason}`);
}
</span></span></pre></td>
</tr></table>
</div></div>
<p>Much of the power of promises comes from the fact that they can be
chained together to perform sequential asynchronous operations:</p>
<div class="highlight js "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
</pre></td>
  <td class="code"><pre><span class="comment">// Note: jQuery AJAX methods return promises</span>
<span class="keyword">var</span> usernamesPromise = Ember.<span class="predefined">$</span>.getJSON(<span class="string"><span class="delimiter">'</span><span class="content">/usernames.json</span><span class="delimiter">'</span></span>);

usernamesPromise.then(fetchPhotosOfUsers)
                .then(applyInstagramFilters)
                .then(uploadTrendyPhotoAlbum)
                .then(displaySuccessMessage, handleErrors);
</pre></td>
</tr></table>
</div></div>
<p>In the above example, if any of the methods
<code>fetchPhotosOfUsers</code>, <code>applyInstagramFilters</code>, or
<code>uploadTrendyPhotoAlbum</code> returns a promise that rejects,
<code>handleErrors</code> will be called with
the reason for the failure. In this manner, promises approximate an
asynchronous form of try-catch statements that prevent the rightward
flow of nested callback after nested callback and facilitate a saner
approach to managing complex asynchronous logic in your applications.</p>

<p>This guide doesn&#39;t intend to fully delve into all the different ways
promises can be used, but if you&#39;d like a more thorough introduction,
take a look at the readme for <a href="https://github.com/tildeio/rsvp.js">RSVP</a>,
the promise library that Ember uses.</p>
<h3 class='anchorable-toc' id='toc_the-router-pauses-for-promises'>The Router Pauses for Promises</h3>
<p>When transitioning between routes, the Ember router collects all of the
models (via the <code>model</code> hook) that will be passed to the route&#39;s
controllers at the end of the transition. If the <code>model</code> hook (or the related
<code>beforeModel</code> or <code>afterModel</code> hooks) return normal (non-promise) objects or
arrays, the transition will complete immediately. But if the <code>model</code> hook
(or the related <code>beforeModel</code> or <code>afterModel</code> hooks) returns a promise (or
if a promise was provided as an argument to <code>transitionTo</code>), the transition
will pause until that promise fulfills or rejects.</p>

<p>The router considers any object with a <code>then</code> method
defined on it to be a promise.</p>

<p>If the promise fulfills, the transition will pick up where it left off and
begin resolving the next (child) route&#39;s model, pausing if it too is a
promise, and so on, until all destination route models have been
resolved. The values passed to the <code>setupController</code> hook for each route
will be the fulfilled values from the promises.</p>

<p>A basic example:</p>
<div class="highlight javascript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay">
  <thead>
    <tr>
      <td colspan="2">app/routes/tardy.js</td>
    </tr>
  </thead>
<tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
12
13
</pre></td>
  <td class="code"><pre><span class="reserved">export</span> <span class="keyword">default</span> Ember.Route.extend({
  model() {
    <span class="keyword">return</span> <span class="keyword">new</span> Ember.RSVP.Promise(<span class="keyword">function</span>(resolve) {
      Ember.run.later(<span class="keyword">function</span>() {
        resolve({ <span class="key">msg</span>: <span class="string"><span class="delimiter">'</span><span class="content">Hold Your Horses</span><span class="delimiter">'</span></span> });
      }, <span class="integer">3000</span>);
    });
  },

  setupController(controller, model) {
    console.log(model.msg); <span class="comment">// &quot;Hold Your Horses&quot;</span>
  }
});
</pre></td>
</tr></table>
</div></div>
<p>When transitioning into <code>route:tardy</code>, the <code>model</code> hook will be called and
return a promise that won&#39;t resolve until 3 seconds later, during which time
the router will be paused in mid-transition. When the promise eventually
fulfills, the router will continue transitioning and eventually call
<code>route:tardy</code>&#39;s <code>setupController</code> hook with the resolved object.</p>

<p>This pause-on-promise behavior is extremely valuable for when you need
to guarantee that a route&#39;s data has fully loaded before displaying a
new template.</p>
<h3 class='anchorable-toc' id='toc_when-promises-reject'>When Promises Reject...</h3>
<p>We&#39;ve covered the case when a model promise fulfills, but what if it rejects?</p>

<p>By default, if a model promise rejects during a transition, the transition is
aborted, no new destination route templates are rendered, and an error
is logged to the console.</p>

<p>You can configure this error-handling logic via the <code>error</code> handler on
the route&#39;s <code>actions</code> hash. When a promise rejects, an <code>error</code> event
will be fired on that route and bubble up to <code>route:application</code>&#39;s
default error handler unless it is handled by a custom error handler
along the way, e.g.:</p>
<div class="highlight javascript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay">
  <thead>
    <tr>
      <td colspan="2">app/routes/good-for-nothing.js</td>
    </tr>
  </thead>
<tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
12
13
14
15
16
17
</pre></td>
  <td class="code"><pre><span class="reserved">export</span> <span class="keyword">default</span> Ember.Route.extend({
  model() {
    <span class="keyword">return</span> Ember.RSVP.reject(<span class="string"><span class="delimiter">&quot;</span><span class="content">FAIL</span><span class="delimiter">&quot;</span></span>);
  },

  <span class="key">actions</span>: {
    error(reason) {
      alert(reason); <span class="comment">// &quot;FAIL&quot;</span>

      <span class="comment">// Can transition to another route here, e.g.</span>
      <span class="comment">// this.transitionTo('index');</span>

      <span class="comment">// Uncomment the line below to bubble this error event:</span>
      <span class="comment">// return true;</span>
    }
  }
});
</pre></td>
</tr></table>
</div></div>
<p>In the above example, the error event would stop right at
<code>route:good-for-nothing</code>&#39;s error handler and not continue to bubble. To
make the event continue bubbling up to <code>route:application</code>, you can
return true from the error handler.</p>
<h3 class='anchorable-toc' id='toc_recovering-from-rejection'>Recovering from Rejection</h3>
<p>Rejected model promises halt transitions, but because promises are chainable,
you can catch promise rejects within the <code>model</code> hook itself and convert
them into fulfills that won&#39;t halt the transition.</p>
<div class="highlight javascript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay">
  <thead>
    <tr>
      <td colspan="2">app/routes/funky.js</td>
    </tr>
  </thead>
<tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
</pre></td>
  <td class="code"><pre><span class="reserved">export</span> <span class="keyword">default</span> Ember.Route.extend({
  model() {
    <span class="keyword">return</span> iHopeThisWorks().then(<span class="predefined-constant">null</span>, <span class="keyword">function</span>() {
      <span class="comment">// Promise rejected, fulfill with some default value to</span>
      <span class="comment">// use as the route's model and continue on with the transition</span>
      <span class="keyword">return</span> { <span class="key">msg</span>: <span class="string"><span class="delimiter">'</span><span class="content">Recovered from rejected promise</span><span class="delimiter">'</span></span> };
    });
  }
});
</pre></td>
</tr></table>
</div></div>


          
      <footer>
        <a class="previous-guide" href="../query-params/"> ← Query Parameters</a> <a class="next-guide" href="../../templates/handlebars-basics/">We've finished covering Routing. Next up: Templates - Handlebars Basics →</a>
      </footer>
      
        </div>
      </div>
    </div>

    <div id="footer">
      <div id="footer-wrapper">
        <div class="info">
          Copyright 2015 <a href="http://tilde.io">Tilde Inc.</a><br>
          <a href="http://emberjs.com/team">Core Team</a> | <a href="http://emberjs.com/sponsors">Sponsors</a> | <a href="http://emberjs.com/legal">Legal</a></br>
          <a href="http://emberjs.com/guidelines">Community Guidelines</a>
        </div>
        <div class="statement">Ember.js is free, open source and always will be.</div>
        <div class="links">
          <a class="twitter" href="http://twitter.com/emberjs">
            <i class="icon-twitter"></i><span>Twitter</span>
          </a>
          <a class="github" href="https://github.com/emberjs/ember.js">
            <i class="icon-github"></i><span>GitHub</span>
          </a>
          <a class="googleplus" href="https://plus.google.com/communities/106387049790387471205">
            <i class="icon-gplus"></i><span>Google+</span>
          </a>
        </div>
      </div>
    </div>

    

    <script type="text/javascript">
      var _gaq = _gaq || [];
      var pluginUrl = '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
      _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
      _gaq.push(['_setAccount', 'UA-27675533-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </body>
</html>
